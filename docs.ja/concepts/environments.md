# 環境

環境は、変更内容をテストおよびプレビューできる独立した名前空間です。

SQLMesh は、本番環境と開発環境を区別します。現在、SQLMesh は `prod` という名前の環境のみを本番環境として扱います。その他の名前の環境は開発環境として扱われます。

開発環境の [モデル](models/overview.md) の名前のスキーマ部分には、特別なサフィックスが付加されます。たとえば、ターゲット環境 `my_dev` にある `db.model_a` という名前のモデルのデータにアクセスするには、クエリでテーブル名 `db__my_dev.model_a` を使用する必要があります。本番環境のモデルは、元の名前で参照されます。

## 環境を使用する理由

データパイプラインとその依存関係は時間の経過とともに複雑化する傾向があり、ローカルな変更の影響を評価することは非常に困難になる可能性があります。パイプラインの所有者は、パイプラインの下流のすべてのコンシューマーを把握していないか、変更の影響を大幅に過小評価している可能性があります。そのため、本番環境の依存関係とデータを使用してモデルの変更を反復してテストすると同時に、現在本番環境で使用されている既存のデータセットやパイプラインへの影響を回避することが非常に重要です。特定の変更を加えてデータウェアハウス全体を再作成することは、その影響を完全に把握するための理想的な解決策ですが、このプロセスは通常、非常にコストと時間がかかります。

SQLMesh環境を使用すると、データウェアハウスの浅い「クローン」を迅速かつ効率的に簡単に作成できます。SQLMeshは、ターゲット環境と比較してどのモデルが変更されたかを認識し、変更によって直接発生したデータギャップのみを計算します。ターゲット環境内での変更やバックフィルは、他の環境に**影響を与えません**。同時に、この環境で行われた計算は、他の環境で**安全に再利用**できます。

## 環境の使用方法

[plan](plans.md) コマンドを実行する際、最初の引数で環境名を指定できます。環境名には任意の文字列を使用できます。デフォルトで唯一の特別な環境名は `prod` であり、これは実稼働環境を指します。`prod` 以外の名前を持つ環境は開発環境とみなされます。

デフォルトでは、[`sqlmesh plan`](plans.md) コマンドは本番環境 (`prod`) を対象とします。

### 例

開発環境を作成または更新する際、引数としてカスタム名を指定できます。例えば、`my_dev` という名前の環境をターゲットにするには、次のコマンドを実行します。

```bash
sqlmesh plan my_dev
```
プランが初めて適用されると、新しい環境が自動的に作成されます。

## 環境の仕組み

モデル定義が変更されるたびに、一意の[フィンガープリント](architecture/snapshots.md#fingerprints)を持つ新しいモデルスナップショットが作成されます。このフィンガープリントにより、SQLMeshは特定のモデルバリアントが他の環境に存在するか、それとも全く新しいバリアントであるかを検出できます。モデルは他のモデルに依存する場合があるため、対象のモデルバリアントのフィンガープリントには、上流の依存関係のフィンガープリントも含まれます。SQLMeshに既にフィンガープリントが存在する場合、そのモデルバリアントに関連付けられた既存の物理テーブルを再利用できます。これは、そのテーブルにデータを入力するロジックが全く同じであると確信しているためです。これにより、環境はモデル[スナップショット](architecture/snapshots.md)への参照のコレクションになります。

詳細については、[プラン](plans.md#plan-application)を参照してください。

## 日付範囲

開発環境には開始日と終了日が含まれます。開発環境を作成する際、通常はデータのサブセットに対する変更をテストすることが目的となります。このようなサブセットのサイズは、環境の開始日と終了日によって定義される期間によって決まります。開始日と終了日は両方とも、[プラン](plans.md) の作成時に指定されます。
